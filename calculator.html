<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Calculator | Blox Values</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        /* --- THEME --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        body { background-color: #050505; color: #fff; padding-bottom: 50px; font-size: 14px; min-height: 100vh; }

        /* HEADER */
        header { background: #000; padding: 20px; text-align: center; border-bottom: 2px solid #333; position: relative; }
        .logo { font-family: 'Fredoka', sans-serif; font-size: 2rem; color: #fff; text-decoration: none; }
        .logo span { color: #a29bfe; }
        .back-btn { 
            position: absolute; left: 20px; top: 50%; transform: translateY(-50%);
            background: #222; color: white; padding: 8px 15px; border-radius: 8px; 
            text-decoration: none; font-weight: bold; border: 1px solid #444; transition: 0.3s;
        }
        .back-btn:hover { background: #a29bfe; border-color: #a29bfe; color: #000; }

        /* CALCULATOR CONTAINER */
        .calc-container {
            max-width: 1100px; margin: 30px auto; padding: 15px;
            display: flex; flex-wrap: wrap; gap: 20px; justify-content: center;
        }

        .trade-box {
            flex: 1; min-width: 350px; background: #111; border: 1px solid #333;
            border-radius: 15px; padding: 20px; display: flex; flex-direction: column;
            min-height: 500px;
        }

        .box-title { text-align: center; font-size: 1.5rem; font-weight: bold; margin-bottom: 15px; font-family: 'Fredoka', sans-serif; }
        .give-title { color: #ff4757; }
        .get-title { color: #2ed573; }

        /* ITEM LIST IN BOX */
        .item-list { flex-grow: 1; overflow-y: auto; margin-bottom: 15px; max-height: 400px; }
        
        .trade-item {
            display: flex; align-items: center; background: #0a0a0a; border: 1px solid #333;
            padding: 10px; border-radius: 10px; margin-bottom: 8px; animation: popIn 0.3s ease;
        }
        .item-img { width: 45px; height: 45px; object-fit: contain; margin-right: 10px; }
        .item-info { flex-grow: 1; }
        .item-name { font-weight: bold; font-size: 0.95rem; }
        .item-val { font-size: 0.85rem; color: #e1b12c; font-weight: bold; }
        
        .remove-btn { color: #ff4757; cursor: pointer; padding: 5px; font-size: 1.1rem; }

        /* PERM SWITCH */
        .perm-switch {
            display: inline-flex; align-items: center; margin-top: 5px; cursor: pointer; user-select: none;
        }
        .switch-label { font-size: 0.75rem; color: #777; margin-right: 5px; font-weight: bold; }
        .toggle-bg {
            width: 36px; height: 18px; background: #333; border-radius: 10px; position: relative; transition: 0.3s;
        }
        .toggle-dot {
            width: 14px; height: 14px; background: #fff; border-radius: 50%;
            position: absolute; top: 2px; left: 2px; transition: 0.3s;
        }
        /* Active State */
        .perm-active .toggle-bg { background: #a29bfe; }
        .perm-active .toggle-dot { transform: translateX(18px); }
        .perm-active .switch-label { color: #a29bfe; }

        /* ADD BUTTON */
        .add-btn {
            width: 100%; padding: 15px; background: #1a1a1a; border: 2px dashed #444;
            color: #aaa; border-radius: 10px; font-size: 1rem; cursor: pointer; transition: 0.2s;
        }
        .add-btn:hover { border-color: #a29bfe; color: #fff; background: #222; }

        /* TOTALS */
        .total-box {
            background: #222; padding: 15px; border-radius: 10px; text-align: right;
            border: 1px solid #444; margin-top: 10px;
        }
        .total-label { font-size: 0.8rem; color: #aaa; }
        .total-val { font-size: 1.4rem; font-weight: bold; }

        /* RESULT BAR */
        .result-bar {
            width: 95%; max-width: 1100px; margin: 0 auto;
            background: #111; border: 1px solid #333; padding: 20px;
            border-radius: 15px; text-align: center;
        }
        .status-text { font-size: 2.5rem; font-family: 'Fredoka'; margin-bottom: 5px; }
        .diff-text { color: #aaa; font-size: 1rem; }

        .status-win { color: #2ed573; text-shadow: 0 0 15px rgba(46,213,115,0.3); }
        .status-fair { color: #e1b12c; text-shadow: 0 0 15px rgba(225,177,44,0.3); }
        .status-loss { color: #ff4757; text-shadow: 0 0 15px rgba(255,71,87,0.3); }

        /* MODAL */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: #111; width: 95%; max-width: 450px; height: 80vh;
            border-radius: 15px; border: 1px solid #444; display: flex; flex-direction: column;
        }
        .modal-header { padding: 15px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { overflow-y: auto; flex-grow: 1; padding: 10px; }
        
        .modal-search {
            width: 100%; padding: 10px; background: #222; border: 1px solid #444;
            color: white; border-radius: 8px; outline: none; margin-bottom: 10px;
        }
        
        .select-item {
            display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #222;
            cursor: pointer; transition: 0.2s;
        }
        .select-item:hover { background: #1a1a1a; }
        .select-item img { width: 40px; height: 40px; margin-right: 10px; }
        .cat-tag { font-size: 0.7rem; padding: 2px 5px; border-radius: 3px; margin-left: auto; text-transform: uppercase; }
        .tag-fruit { background: #222; color: #aaa; }
        .tag-limited { background: #00cec9; color: #000; }
        .tag-gamepass { background: #6c5ce7; color: #fff; }

        @keyframes popIn { from{opacity:0; transform:scale(0.9);} to{opacity:1; transform:scale(1);} }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="back-btn">â¬… Back</a>
        <a href="index.html" class="logo">Blox<span>Calc</span></a>
    </header>

    <div class="result-bar">
        <div id="status" class="status-text">---</div>
        <div id="diff" class="diff-text">Add items to calculate trade</div>
    </div>

    <div class="calc-container">
        <div class="trade-box">
            <div class="box-title give-title">YOU GIVE</div>
            <div class="item-list" id="give-list"></div>
            <button class="add-btn" onclick="openModal('give')">+ Add Item</button>
            <div class="total-box">
                <div class="total-label">TOTAL VALUE</div>
                <div class="total-val" id="give-total" style="color: #ff4757;">0</div>
            </div>
        </div>

        <div class="trade-box">
            <div class="box-title get-title">YOU GET</div>
            <div class="item-list" id="get-list"></div>
            <button class="add-btn" onclick="openModal('get')">+ Add Item</button>
            <div class="total-box">
                <div class="total-label">TOTAL VALUE</div>
                <div class="total-val" id="get-total" style="color: #2ed573;">0</div>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin:0">Select Item</h3>
                <button onclick="closeModal()" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            <div style="padding: 10px;">
                <input type="text" id="modal-search" class="modal-search" placeholder="Search item (e.g. Eagle Glacier)...">
            </div>
            <div class="modal-body" id="modal-items"></div>
        </div>
    </div>

    <script>
        const defaultImg = "https://i.ibb.co.com/G690n9m/Logo.png";

        // --- FULL DATA (Fruits, Limiteds, Gamepasses) ---
        const data = [
            // FRUITS (Have Perm Toggle)
            { name: "West Dragon", val: "3.33B", permVal: "6.65B", category: "fruit", img: defaultImg },
            { name: "East Dragon", val: "2.91B", permVal: "6.65B", category: "fruit", img: defaultImg },
            { name: "Kitsune", val: "420M", permVal: "5.81B", category: "fruit", img: defaultImg },
            { name: "Tiger", val: "160M", permVal: "4.36B", category: "fruit", img: defaultImg },
            { name: "Yeti", val: "150M", permVal: "4.36B", category: "fruit", img: defaultImg },
            { name: "Control", val: "140M", permVal: "5.81B", category: "fruit", img: defaultImg },
            { name: "Gas", val: "60M", permVal: "3.32B", category: "fruit", img: defaultImg },
            { name: "Spirit", val: "10M", permVal: "3.32B", category: "fruit", img: defaultImg },
            { name: "Dough", val: "30M", permVal: "2.9B", category: "fruit", img: defaultImg },
            { name: "T-Rex", val: "20M", permVal: "2.9B", category: "fruit", img: defaultImg },
            { name: "Mammoth", val: "10M", permVal: "2.9B", category: "fruit", img: defaultImg },
            { name: "Venom", val: "20M", permVal: "2.9B", category: "fruit", img: defaultImg },
            { name: "Shadow", val: "6.5M", permVal: "2.9B", category: "fruit", img: defaultImg },
            { name: "Gravity", val: "10M", permVal: "2.75B", category: "fruit", img: defaultImg },
            { name: "Pain", val: "10M", permVal: "2.48B", category: "fruit", img: defaultImg },
            { name: "Lightning", val: "80M", permVal: "2.33B", category: "fruit", img: defaultImg },
            { name: "Blizzard", val: "5M", permVal: "2.29B", category: "fruit", img: defaultImg },
            { name: "Portal", val: "10M", permVal: "1.76B", category: "fruit", img: defaultImg },
            { name: "Phoenix", val: "2.75M", permVal: "1.76B", category: "fruit", img: defaultImg },
            { name: "Sound", val: "2.5M", permVal: "1.61B", category: "fruit", img: defaultImg },
            { name: "Spider", val: "1.5M", permVal: "1.46B", category: "fruit", img: defaultImg },
            { name: "Creation", val: "3.5M", permVal: "1.39B", category: "fruit", img: defaultImg },
            { name: "Buddha", val: "10M", permVal: "1.32B", category: "fruit", img: defaultImg },
            { name: "Love", val: "1.5M", permVal: "1.32B", category: "fruit", img: defaultImg },
            { name: "Quake", val: "1M", permVal: "1.1B", category: "fruit", img: defaultImg },
            { name: "Magma", val: "1.15M", permVal: "1.04B", category: "fruit", img: defaultImg },
            { name: "Ghost", val: "800K", permVal: "720M", category: "fruit", img: defaultImg },
            { name: "Rubber", val: "700K", permVal: "690M", category: "fruit", img: defaultImg },
            { name: "Light", val: "800K", permVal: "690M", category: "fruit", img: defaultImg },
            { name: "Diamond", val: "1M", permVal: "630M", category: "fruit", img: defaultImg },
            { name: "Eagle", val: "800K", permVal: "570M", category: "fruit", img: defaultImg },
            { name: "Dark", val: "400K", permVal: "570M", category: "fruit", img: defaultImg },
            { name: "Sand", val: "420K", permVal: "480M", category: "fruit", img: defaultImg },
            { name: "Ice", val: "550K", permVal: "440M", category: "fruit", img: defaultImg },
            { name: "Flame", val: "250K", permVal: "270M", category: "fruit", img: defaultImg },
            { name: "Spike", val: "180K", permVal: "95M", category: "fruit", img: defaultImg },
            { name: "Smoke", val: "100K", permVal: "63M", category: "fruit", img: defaultImg },
            { name: "Bomb", val: "80K", permVal: "55M", category: "fruit", img: defaultImg },
            { name: "Spring", val: "60K", permVal: "45M", category: "fruit", img: defaultImg },
            { name: "Blade", val: "50K", permVal: "20M", category: "fruit", img: defaultImg },
            { name: "Spin", val: "15M", permVal: "15M", category: "fruit", img: defaultImg },
            { name: "Rocket", val: "10M", permVal: "10M", category: "fruit", img: defaultImg },

            // LIMITEDS & SPECIALS (No Toggle)
            { name: "Perm Dragon Token", val: "3.33B", category: "limited", img: defaultImg },
            { name: "Galaxy Empyrean Kitsune", val: "4.56B", category: "limited", img: defaultImg },
            { name: "Ember West Dragon", val: "3.75B", category: "limited", img: defaultImg },
            { name: "Crimson Kitsune", val: "3.07B", category: "limited", img: defaultImg },
            { name: "Divine Portal", val: "340M", category: "limited", img: defaultImg },
            { name: "Purple Lightning", val: "2.46B", category: "limited", img: defaultImg },
            { name: "Red Lightning", val: "600M", category: "limited", img: defaultImg },
            { name: "Yellow Lightning", val: "760M", category: "limited", img: defaultImg },
            { name: "Green Lightning", val: "140M", category: "limited", img: defaultImg },
            { name: "Werewolf", val: "345M", category: "limited", img: defaultImg },
            { name: "Super Spirit Pain", val: "570M", category: "limited", img: defaultImg },
            { name: "Torment Pain", val: "60M", category: "limited", img: defaultImg },
            { name: "Sadness Pain", val: "290M", category: "limited", img: defaultImg },
            { name: "Frustration Pain", val: "200M", category: "limited", img: defaultImg },
            { name: "Celestial Pain", val: "270M", category: "limited", img: defaultImg },
            { name: "Eagle Requiem", val: "90M", category: "limited", img: defaultImg },
            { name: "Eagle Glacier", val: "20M", category: "limited", img: defaultImg },
            { name: "Eagle Matrix", val: "135M", category: "limited", img: defaultImg },
            { name: "Celebration Bomb", val: "5M", category: "limited", img: defaultImg },
            { name: "Azura Bomb", val: "160M", category: "limited", img: defaultImg },
            { name: "Thermite Bomb", val: "160M", category: "limited", img: defaultImg },
            { name: "Nuclear Bomb", val: "160M", category: "limited", img: defaultImg },
            { name: "Rose Quartz Diamond", val: "60M", category: "limited", img: defaultImg },
            { name: "Emerald Diamond", val: "50M", category: "limited", img: defaultImg },
            { name: "Topaz Diamond", val: "50M", category: "limited", img: defaultImg },
            { name: "Ruby Diamond", val: "30M", category: "limited", img: defaultImg },
            { name: "Dragon Token", val: "N/A", category: "limited", img: defaultImg },
            { name: "Eclipse", val: "N/A", category: "limited", img: defaultImg },
            { name: "Pink Portal", val: "N/A", category: "limited", img: defaultImg },
            { name: "Orange Portal", val: "N/A", category: "limited", img: defaultImg },
            { name: "Parrot", val: "N/A", category: "limited", img: defaultImg },

            // GAMEPASS (No Toggle)
            { name: "Fruit Notifier", val: "3.99B", category: "gamepass", img: defaultImg },
            { name: "Dark Blade", val: "840M", category: "gamepass", img: defaultImg },
            { name: "Mythical Scrolls", val: "700M", category: "gamepass", img: defaultImg },
            { name: "Legendary Scrolls", val: "415M", category: "gamepass", img: defaultImg },
            { name: "+1 Fruit Storage", val: "255M", category: "gamepass", img: defaultImg },
            { name: "2x Mastery", val: "280M", category: "gamepass", img: defaultImg },
            { name: "2x Money", val: "280M", category: "gamepass", img: defaultImg },
            { name: "2x Boss Drops", val: "170M", category: "gamepass", img: defaultImg },
            { name: "Fast Boats", val: "170M", category: "gamepass", img: defaultImg }
        ];

        // --- STATE ---
        let giveItems = [];
        let getItems = [];
        let activeSide = '';

        // --- HELPERS ---
        function parseVal(str) {
            str = String(str).toUpperCase().replace(/,/g, '');
            if(str.includes('B')) return parseFloat(str) * 1_000_000_000;
            if(str.includes('M')) return parseFloat(str) * 1_000_000;
            if(str.includes('K')) return parseFloat(str) * 1_000;
            return parseFloat(str) || 0;
        }
        function formatVal(num) {
            if(num >= 1e9) return (num/1e9).toFixed(2) + 'B';
            if(num >= 1e6) return (num/1e6).toFixed(1) + 'M';
            if(num >= 1e3) return (num/1e3).toFixed(0) + 'K';
            return num;
        }

        // --- RENDER ---
        function renderList(side) {
            const listEl = document.getElementById(side + '-list');
            const items = side === 'give' ? giveItems : getItems;
            listEl.innerHTML = '';

            items.forEach((item, index) => {
                let displayVal = item.isPerm ? item.permVal : item.val;
                let displayName = item.name + (item.isPerm ? " (Perm)" : "");
                
                // Toggle Switch HTML (Only for fruits)
                let toggleHtml = '';
                if(item.category === 'fruit') {
                    let activeClass = item.isPerm ? 'perm-active' : '';
                    toggleHtml = `
                    <div class="perm-switch ${activeClass}" onclick="toggleItemMode('${side}', ${index})">
                        <span class="switch-label">Perm?</span>
                        <div class="toggle-bg"><div class="toggle-dot"></div></div>
                    </div>`;
                }

                listEl.innerHTML += `
                <div class="trade-item">
                    <img src="${item.img}" class="item-img">
                    <div class="item-info">
                        <div class="item-name">${displayName}</div>
                        <div class="item-val">${displayVal}</div>
                        ${toggleHtml}
                    </div>
                    <div class="remove-btn" onclick="removeItem('${side}', ${index})">&times;</div>
                </div>`;
            });

            updateTotals();
        }

        function updateTotals() {
            let giveTotal = giveItems.reduce((acc, i) => acc + parseVal(i.isPerm ? i.permVal : i.val), 0);
            let getTotal = getItems.reduce((acc, i) => acc + parseVal(i.isPerm ? i.permVal : i.val), 0);

            document.getElementById('give-total').innerText = formatVal(giveTotal);
            document.getElementById('get-total').innerText = formatVal(getTotal);

            // Calc Result
            const statusEl = document.getElementById('status');
            const diffEl = document.getElementById('diff');

            if(giveTotal === 0 && getTotal === 0) {
                statusEl.innerHTML = "---";
                statusEl.className = "status-text";
                diffEl.innerText = "Add items to calculate";
                return;
            }

            let pct = giveTotal === 0 ? 100 : (getTotal / giveTotal) * 100;
            let diff = getTotal - giveTotal;
            let diffStr = (diff >= 0 ? "+" : "") + formatVal(diff);

            if(pct >= 110) { statusEl.innerText = "BIG WIN ðŸš€"; statusEl.className = "status-text status-win"; }
            else if(pct >= 102) { statusEl.innerText = "WIN âœ…"; statusEl.className = "status-text status-win"; }
            else if(pct >= 90) { statusEl.innerText = "FAIR âš–ï¸"; statusEl.className = "status-text status-fair"; }
            else { statusEl.innerText = "LOSS âŒ"; statusEl.className = "status-text status-loss"; }

            diffEl.innerText = `${diffStr} Value Difference`;
        }

        // --- ACTIONS ---
        function toggleItemMode(side, index) {
            let list = side === 'give' ? giveItems : getItems;
            // Only toggle if Perm Val exists
            if(list[index].permVal) {
                list[index].isPerm = !list[index].isPerm;
                renderList(side);
            }
        }

        function removeItem(side, index) {
            if(side === 'give') giveItems.splice(index, 1);
            else getItems.splice(index, 1);
            renderList(side);
        }

        // --- MODAL ---
        function openModal(side) {
            activeSide = side;
            document.getElementById('modal').style.display = 'flex';
            renderModalItems();
        }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        function renderModalItems() {
            const list = document.getElementById('modal-items');
            const search = document.getElementById('modal-search').value.toLowerCase();
            list.innerHTML = '';

            data.filter(x => x.name.toLowerCase().includes(search)).forEach(item => {
                let catClass = 'tag-fruit';
                if(item.category === 'limited') catClass = 'tag-limited';
                if(item.category === 'gamepass') catClass = 'tag-gamepass';

                const div = document.createElement('div');
                div.className = 'select-item';
                div.innerHTML = `
                    <img src="${item.img}"> 
                    <div><b>${item.name}</b> <br> <span style="color:#e1b12c">${item.val}</span></div>
                    <span class="cat-tag ${catClass}">${item.category}</span>
                `;
                div.onclick = () => {
                    let newItem = { ...item, isPerm: false }; 
                    if(activeSide === 'give') giveItems.push(newItem);
                    else getItems.push(newItem);
                    renderList(activeSide);
                    closeModal();
                };
                list.appendChild(div);
            });
        }
        document.getElementById('modal-search').addEventListener('input', renderModalItems);

    </script>
</body>
</html>
