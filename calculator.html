<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Calculator | Blox Values</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        /* --- THEME --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        body { background-color: #050505; color: #fff; padding-bottom: 50px; font-size: 14px; min-height: 100vh; }

        /* HEADER */
        header { background: #000; padding: 20px; text-align: center; border-bottom: 2px solid #333; position: relative; }
        .logo { font-family: 'Fredoka', sans-serif; font-size: 2rem; color: #fff; text-decoration: none; }
        .logo span { color: #a29bfe; }
        .back-btn { 
            position: absolute; left: 20px; top: 50%; transform: translateY(-50%);
            background: #222; color: white; padding: 8px 15px; border-radius: 8px; 
            text-decoration: none; font-weight: bold; border: 1px solid #444; transition: 0.3s;
        }
        .back-btn:hover { background: #a29bfe; border-color: #a29bfe; color: #000; }

        /* CALCULATOR CONTAINER */
        .calc-container {
            max-width: 1100px; margin: 30px auto; padding: 15px;
            display: flex; flex-wrap: wrap; gap: 20px; justify-content: center;
        }

        .trade-box {
            flex: 1; min-width: 350px; background: #111; border: 1px solid #333;
            border-radius: 15px; padding: 20px; display: flex; flex-direction: column;
            min-height: 500px;
        }

        .box-header { text-align: center; margin-bottom: 15px; }
        .box-title { font-size: 1.5rem; font-weight: bold; font-family: 'Fredoka', sans-serif; margin-bottom: 5px; }
        .give-title { color: #ff4757; }
        .get-title { color: #2ed573; }

        /* HEADER PRICE (ACTUAL PRICE) */
        .price-label { font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; color: #ccc; }
        .price-val-text { color: #fff; font-family: monospace; font-size: 1.2rem; } 

        /* DEMAND STATS */
        .demand-stat {
            font-size: 0.85rem; font-weight: bold; background: #222; 
            padding: 4px 10px; border-radius: 15px; display: inline-block; border: 1px solid #444;
            color: #aaa; margin-top: 5px;
        }
        .dem-val { color: white; margin-left: 5px; }
        .dem-high { color: #2ed573; }
        .dem-mid { color: #e1b12c; }
        .dem-low { color: #ff4757; }

        /* ITEM LIST IN BOX */
        .item-list { flex-grow: 1; overflow-y: auto; margin-bottom: 15px; max-height: 400px; }
        
        .trade-item {
            display: flex; align-items: center; background: #0a0a0a; border: 1px solid #333;
            padding: 10px; border-radius: 10px; margin-bottom: 8px; animation: popIn 0.3s ease; position: relative;
        }
        .item-img { width: 45px; height: 45px; object-fit: contain; margin-right: 10px; }
        .item-info { flex-grow: 1; }
        .item-name { font-weight: bold; font-size: 0.95rem; }
        .item-val { font-size: 0.85rem; color: #e1b12c; font-weight: bold; }
        .item-dem-tag { font-size: 0.7rem; color: #777; position: absolute; top: 5px; right: 30px; }
        
        .remove-btn { color: #ff4757; cursor: pointer; padding: 5px; font-size: 1.1rem; }

        /* PERM SWITCH */
        .perm-switch {
            display: inline-flex; align-items: center; margin-top: 5px; cursor: pointer; user-select: none;
        }
        .switch-label { font-size: 0.75rem; color: #777; margin-right: 5px; font-weight: bold; }
        .toggle-bg {
            width: 36px; height: 18px; background: #333; border-radius: 10px; position: relative; transition: 0.3s;
        }
        .toggle-dot {
            width: 14px; height: 14px; background: #fff; border-radius: 50%;
            position: absolute; top: 2px; left: 2px; transition: 0.3s;
        }
        /* Active State */
        .perm-active .toggle-bg { background: #a29bfe; }
        .perm-active .toggle-dot { transform: translateX(18px); }
        .perm-active .switch-label { color: #a29bfe; }

        /* ADD BUTTON */
        .add-btn {
            width: 100%; padding: 15px; background: #1a1a1a; border: 2px dashed #444;
            color: #aaa; border-radius: 10px; font-size: 1rem; cursor: pointer; transition: 0.2s;
        }
        .add-btn:hover { border-color: #a29bfe; color: #fff; background: #222; }

        /* TOTALS (TRADING VALUE) */
        .total-box {
            background: #222; padding: 15px; border-radius: 10px; text-align: right;
            border: 1px solid #444; margin-top: 10px;
        }
        .total-label { font-size: 0.8rem; color: #aaa; }
        .total-val { font-size: 1.4rem; font-weight: bold; }

        /* RESULT BAR */
        .result-bar {
            width: 95%; max-width: 1100px; margin: 0 auto;
            background: #111; border: 1px solid #333; padding: 20px;
            border-radius: 15px; text-align: center;
        }
        .status-text { font-size: 2.5rem; font-family: 'Fredoka'; margin-bottom: 5px; }
        .diff-text { color: #aaa; font-size: 1rem; }

        .status-win { color: #2ed573; text-shadow: 0 0 15px rgba(46,213,115,0.3); }
        .status-fair { color: #e1b12c; text-shadow: 0 0 15px rgba(225,177,44,0.3); }
        .status-loss { color: #ff4757; text-shadow: 0 0 15px rgba(255,71,87,0.3); }

        /* MODAL */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: #111; width: 95%; max-width: 450px; height: 80vh;
            border-radius: 15px; border: 1px solid #444; display: flex; flex-direction: column;
        }
        .modal-header { padding: 15px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { overflow-y: auto; flex-grow: 1; padding: 10px; }
        
        .modal-search {
            width: 100%; padding: 10px; background: #222; border: 1px solid #444;
            color: white; border-radius: 8px; outline: none; margin-bottom: 10px;
        }
        
        .select-item {
            display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #222;
            cursor: pointer; transition: 0.2s;
        }
        .select-item:hover { background: #1a1a1a; }
        .select-item img { width: 40px; height: 40px; margin-right: 10px; }
        .cat-tag { font-size: 0.7rem; padding: 2px 5px; border-radius: 3px; margin-left: auto; text-transform: uppercase; }
        .tag-fruit { background: #222; color: #aaa; }
        .tag-limited { background: #00cec9; color: #000; }
        .tag-gamepass { background: #6c5ce7; color: #fff; }

        @keyframes popIn { from{opacity:0; transform:scale(0.9);} to{opacity:1; transform:scale(1);} }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="back-btn">â¬… Back</a>
        <a href="index.html" class="logo">Blox<span>Calc</span></a>
    </header>

    <div class="result-bar">
        <div id="status" class="status-text">---</div>
        <div id="diff" class="diff-text">Add items to calculate trade</div>
    </div>

    <div class="calc-container">
        <div class="trade-box">
            <div class="box-header">
                <div class="box-title give-title">YOU GIVE</div>
                <div class="price-label">My Price: <span id="head-give-price" class="price-val-text">$0</span></div>
                <div class="demand-stat">My Avg Demand: <span id="give-demand" class="dem-val dem-low">0/10</span></div>
            </div>
            
            <div class="item-list" id="give-list"></div>
            <button class="add-btn" onclick="openModal('give')">+ Add Item</button>
            
            <div class="total-box">
                <div class="total-label">TOTAL VALUE</div>
                <div class="total-val" id="give-total" style="color: #ff4757;">0</div>
            </div>
        </div>

        <div class="trade-box">
            <div class="box-header">
                <div class="box-title get-title">YOU GET</div>
                <div class="price-label">Them Price: <span id="head-get-price" class="price-val-text">$0</span></div>
                <div class="demand-stat">Them Avg Demand: <span id="get-demand" class="dem-val dem-low">0/10</span></div>
            </div>

            <div class="item-list" id="get-list"></div>
            <button class="add-btn" onclick="openModal('get')">+ Add Item</button>
            
            <div class="total-box">
                <div class="total-label">TOTAL VALUE</div>
                <div class="total-val" id="get-total" style="color: #2ed573;">0</div>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin:0">Select Item</h3>
                <button onclick="closeModal()" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            <div style="padding: 10px;">
                <input type="text" id="modal-search" class="modal-search" placeholder="Search item (e.g. Eagle Glacier)...">
            </div>
            <div class="modal-body" id="modal-items"></div>
        </div>
    </div>

    <script>
        const defaultImg = "https://i.ibb.co.com/G690n9m/Logo.png";

        // --- FULL DATA ---
        const data = [
            // FRUITS (Have Perm Toggle)
            { name: "West Dragon", val: "3.33B", permVal: "6.65B", price: "15M", permPrice: "5K", demand: "10/10", category: "fruit", img: "https://i.postimg.cc/X7Nhnj1B/image-removebg-preview-(41).png" },
            { name: "East Dragon", val: "2.91B", permVal: "6.65B", price: "15M", permPrice: "5K", demand: "10/10", category: "fruit", img: "https://i.postimg.cc/TY2STdNg/image-removebg-preview-(40).png" },
            { name: "Kitsune", val: "420M", permVal: "5.81B", price: "8M", permPrice: "4K", demand: "10/10", category: "fruit", img: "https://i.postimg.cc/ncV5nFS4/image-removebg-preview-(37).png" },
            { name: "Tiger", val: "160M", permVal: "4.36B", price: "5M", permPrice: "3K", demand: "9/10", category: "fruit", img: "https://i.postimg.cc/NfGVQsCJ/image-removebg-preview-(28).png" },
            { name: "Yeti", val: "150M", permVal: "4.36B", price: "5M", permPrice: "3K", demand: "10/10", category: "fruit", img: "https://i.postimg.cc/BQZyJS7x/image-removebg-preview-(38).png" },
            { name: "Control", val: "140M", permVal: "5.81B", price: "9M", permPrice: "4K", demand: "7/10", category: "fruit", img: "https://i.postimg.cc/zXDMqz22/image-removebg-preview-(27).png" },
            { name: "Gas", val: "60M", permVal: "3.32B", price: "3.2M", permPrice: "2.5K", demand: "8/10", category: "fruit", img: "https://i.postimg.cc/SRV1jfLq/download-removebg-preview-(39).png" },
            { name: "Spirit", val: "10M", permVal: "3.32B", price: "3.4M", permPrice: "2.55K", demand: "6/10", category: "fruit", img: "https://i.postimg.cc/9FXScmgP/image-removebg-preview-(36).png" },
            { name: "Dough", val: "30M", permVal: "2.9B", price: "2.8M", permPrice: "2.4K", demand: "10/10", category: "fruit", img: "https://i.postimg.cc/WbpKsNY8/image-removebg-preview-(32).png" },
            { name: "T-Rex", val: "20M", permVal: "2.9B", price: "2.7M", permPrice: "2.35K", demand: "8/10", category: "fruit", img: "https://i.postimg.cc/4N4MXf2w/image-removebg-preview-(31).png" },
            { name: "Mammoth", val: "10M", permVal: "2.9B", price: "2.7M", permPrice: "2.35K", demand: "5/10", category: "fruit", img: "https://i.postimg.cc/yY6571pL/image-removebg-preview-(30).png" },
            { name: "Venom", val: "20M", permVal: "2.9B", price: "3M", permPrice: "2.45K", demand: "10/10", category: "fruit", img: "https://i.postimg.cc/8Pk3TpXB/image-removebg-preview-(35).png" },
            { name: "Shadow", val: "6.5M", permVal: "2.9B", price: "2.9M", permPrice: "2.42K", demand: "5/10", category: "fruit", img: "https://i.postimg.cc/5N9Gf4KS/image-removebg-preview-(33).png" },
            { name: "Gravity", val: "10M", permVal: "2.75B", price: "2.5M", permPrice: "2.3K", demand: "4/10", category: "fruit", img: "https://i.postimg.cc/yY6571pr/image-removebg-preview-(26).png" },
            { name: "Pain", val: "10M", permVal: "2.48B", price: "2.3M", permPrice: "2.2K", demand: "5/10", category: "fruit", img: "https://i.postimg.cc/28jJCkXf/image-removebg-preview-(21).png" },
            { name: "Lightning", val: "80M", permVal: "2.33B", price: "2.1M", permPrice: "2.1K", demand: "8/10", category: "fruit", img: "https://i.postimg.cc/vH8jGY2k/image-removebg-preview-(24).png" },
            { name: "Blizzard", val: "5M", permVal: "2.29B", price: "2.4M", permPrice: "2.25K", demand: "5/10", category: "fruit", img: "https://i.postimg.cc/Gh3NbLg5/image-removebg-preview-(25).png" },
            { name: "Portal", val: "10M", permVal: "1.76B", price: "1.9M", permPrice: "2K", demand: "10/10", category: "fruit", img: "https://i.postimg.cc/xTj79fFD/image-removebg-preview-(22).png" },
            { name: "Phoenix", val: "2.75M", permVal: "1.76B", price: "1.8M", permPrice: "2K", demand: "3/10", category: "fruit", img: "https://i.postimg.cc/5N9Gf4Kh/image-removebg-preview-(23).png" },
            { name: "Sound", val: "2.5M", permVal: "1.61B", price: "1.7M", permPrice: "1.9K", demand: "4/10", category: "fruit", img: "https://i.postimg.cc/VL7h6x2Z/image-removebg-preview-(20).png" },
            { name: "Spider", val: "1.5M", permVal: "1.46B", price: "1.5M", permPrice: "1.8K", demand: "2/10", category: "fruit", img: "https://i.postimg.cc/NfNnM3ZP/image-removebg-preview-(19).png" },
            { name: "Creation", val: "3.5M", permVal: "1.39B", price: "1.4M", permPrice: "1.75K", demand: "3/10", category: "fruit", img: "https://i.postimg.cc/vHPKBJCJ/image-removebg-preview-(14).png" },
            { name: "Buddha", val: "10M", permVal: "1.32B", price: "1.2M", permPrice: "1.65K", demand: "10/10", category: "fruit", img: "https://i.postimg.cc/hPCYjkN5/image-removebg-preview-(17).png" },
            { name: "Love", val: "1.5M", permVal: "1.32B", price: "1.3M", permPrice: "1.7K", demand: "3/10", category: "fruit", img: "https://i.postimg.cc/J4TFnfSF/image-removebg-preview-(18).png" },
            { name: "Quake", val: "1M", permVal: "1.1B", price: "1M", permPrice: "1.5K", demand: "2/10", category: "fruit", img: "https://i.postimg.cc/gkc5GztM/image-removebg-preview-(29).png" },
            { name: "Magma", val: "1.15M", permVal: "1.04B", price: "960K", permPrice: "1.3K", demand: "8/10", category: "fruit", img: "https://i.postimg.cc/bN65J744/image-removebg-preview-(15).png" },
            { name: "Ghost", val: "800K", permVal: "720M", price: "940K", permPrice: "1.27K", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/kXjH40Lz/image-removebg-preview-(16).png" },
            { name: "Rubber", val: "700K", permVal: "690M", price: "750K", permPrice: "1.2K", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/Pr67xg0B/image-removebg-preview-(13).png" },
            { name: "Light", val: "800K", permVal: "690M", price: "650K", permPrice: "1.1K", demand: "2/10", category: "fruit", img: "https://i.postimg.cc/Y2zZcGRx/download-removebg-preview.png" },
            { name: "Diamond", val: "1M", permVal: "630M", price: "600K", permPrice: "1K", demand: "2/10", category: "fruit", img: "https://i.postimg.cc/SNQ5mS1z/download-removebg-preview-(1).png" },
            { name: "Eagle", val: "800K", permVal: "570M", price: "550K", permPrice: "975", demand: "2/10", category: "fruit", img: "https://i.postimg.cc/7YBR6Fpw/image-removebg-preview-(4).png" },
            { name: "Dark", val: "400K", permVal: "570M", price: "500K", permPrice: "950", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/dtWf1bz1/image-removebg-preview-(3).png" },
            { name: "Sand", val: "420K", permVal: "480M", price: "420K", permPrice: "850", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/HsW-KTYvy/download-removebg-preview-(2).png" },
            { name: "Ice", val: "550K", permVal: "440M", price: "350K", permPrice: "750", demand: "2/10", category: "fruit", img: "https://i.postimg.cc/c1B2qghB/download-removebg-preview-(3).png" },
            { name: "Flame", val: "250K", permVal: "270M", price: "250K", permPrice: "550", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/MKsLTChz/image-removebg-preview-(5).png" },
            { name: "Spike", val: "180K", permVal: "95M", price: "180K", permPrice: "380", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/c4DzHpVx/image-removebg-preview-(6).png" },
            { name: "Smoke", val: "100K", permVal: "63M", price: "100K", permPrice: "250", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/RVPYFkjM/image-removebg-preview-(7).png" },
            { name: "Bomb", val: "80K", permVal: "55M", price: "80K", permPrice: "220", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/Wb9y3BQj/image-removebg-preview-(8).png" },
            { name: "Spring", val: "60K", permVal: "45M", price: "60K", permPrice: "180", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/DyCNZ9th/image-removebg-preview-(9).png" },
            { name: "Blade", val: "50K", permVal: "20M", price: "30K", permPrice: "100", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/15WdtkLQ/image-removebg-preview-(10).png" },
            { name: "Spin", val: "15M", permVal: "15M", price: "7.5K", permPrice: "75", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/yYfGdMwC/image-removebg-preview-(11).png" },
            { name: "Rocket", val: "10M", permVal: "10M", price: "5K", permPrice: "50", demand: "1/10", category: "fruit", img: "https://i.postimg.cc/bN65J7KX/image-removebg-preview-(12).png" },
            
            // LIMITED & GAMEPASS
            { name: "Perm Dragon Token", val: "3.33B", price: "N/A", demand: "6/10", category: "limited", img: "https://i.postimg.cc/pXzLDBJd/download-removebg-preview-(37).png" },
            { name: "Galaxy Empyrean Kitsune", val: "4.56B", price: "N/A", demand: "10/10", category: "limited", img: "https://i.postimg.cc/cLW4T8F3/download-removebg-preview-(14).png" },
            { name: "Ember West Dragon", val: "3.75B", price: "N/A", demand: "10/10", category: "limited", img: "https://i.postimg.cc/x1QTgb6v/download-removebg-preview-(13).png" },
            { name: "Crimson Kitsune", val: "3.07B", price: "2K", demand: "10/10", category: "limited", img: "https://i.postimg.cc/Cx0LJfcC/download-removebg-preview-(11).png" },
            { name: "Divine Portal", val: "340M", price: "N/A", demand: "8/10", category: "limited", img: "https://i.postimg.cc/VkwL4bKg/download-removebg-preview-(7).png" },
            { name: "Purple Lightning", val: "2.46B", price: "N/A", demand: "10/10", category: "limited", img: "https://i.postimg.cc/dtrV89j8/download-removebg-preview-(23).png" },
            { name: "Red Lightning", val: "600M", price: "N/A", demand: "10/10", category: "limited", img: "https://i.postimg.cc/vZyHX60W/download-removebg-preview-(10).png" },
            { name: "Yellow Lightning", val: "760M", price: "N/A", demand: "10/10", category: "limited", img: "https://i.postimg.cc/PrY5mMQZ/download-removebg-preview-(24).png" },
            { name: "Green Lightning", val: "140M", price: "N/A", demand: "3/10", category: "limited", img: "https://i.postimg.cc/8PMzhbmL/download-removebg-preview-(25).png" },
            { name: "Werewolf", val: "345M", price: "N/A", demand: "8/10", category: "limited", img: "https://i.postimg.cc/Sx4NVzgr/download-removebg-preview-(8).png" },
            { name: "Super Spirit Pain", val: "570M", price: "N/A", demand: "10/10", category: "limited", img: "https://i.postimg.cc/Dwhy5bxP/download-removebg-preview-(9).png" },
            { name: "Torment Pain", val: "60M", price: "N/A", demand: "3/10", category: "limited", img: defaultImg },
            { name: "Sadness Pain", val: "290M", price: "N/A", demand: "7/10", category: "limited", img: "https://i.postimg.cc/W1VbSJ57/download-removebg-preview-(6).png" },
            { name: "Frustration Pain", val: "200M", price: "N/A", demand: "6/10", category: "limited", img: "https://i.postimg.cc/jdPSzh4W/download-removebg-preview-(30).png" },
            { name: "Celestial Pain", val: "270M", price: "N/A", demand: "7/10", category: "limited", img: "https://i.postimg.cc/YC7q8md8/download-removebg-preview-(5).png" },
            { name: "Eagle Requiem", val: "90M", price: "N/A", demand: "5/10", category: "limited", img: "https://i.postimg.cc/pLvXknsq/download-removebg-preview-(4).png" },
            { name: "Eagle Glacier", val: "20M", price: "N/A", demand: "3/10", category: "limited", img: "https://i.postimg.cc/28hS4x78/download-removebg-preview-(35).png" },
            { name: "Eagle Matrix", val: "135M", price: "N/A", demand: "5/10", category: "limited", img: "https://i.postimg.cc/Qx1dpqJT/download-removebg-preview-(26).png" },
            { name: "Celebration Bomb", val: "5M", price: "N/A", demand: "2/10", category: "limited", img: "https://i.postimg.cc/Wbg1M7w1/download-removebg-preview-(36).png" },
            { name: "Azura Bomb", val: "160M", price: "N/A", demand: "7/10", category: "limited", img: "https://i.postimg.cc/3JmxgZFG/download-removebg-preview-(28).png" },
            { name: "Thermite Bomb", val: "160M", price: "N/A", demand: "7/10", category: "limited", img: "https://i.postimg.cc/yYc8FTyg/download-removebg-preview-(29).png" },
            { name: "Nuclear Bomb", val: "160M", price: "N/A", demand: "7/10", category: "limited", img: "https://i.postimg.cc/zXKGnkFH/download-removebg-preview-(27).png" },
            { name: "Rose Quartz Diamond", val: "60M", price: "N/A", demand: "5/10", category: "limited", img: "https://i.postimg.cc/rFxwS9ND/download-removebg-preview-(31).png" },
            { name: "Emerald Diamond", val: "50M", price: "N/A", demand: "4/10", category: "limited", img: "https://i.postimg.cc/J4ZzbQ5G/download-removebg-preview-(33).png" },
            { name: "Topaz Diamond", val: "50M", price: "N/A", demand: "4/10", category: "limited", img: "https://i.postimg.cc/SNCxWGfj/download-removebg-preview-(32).png" },
            { name: "Ruby Diamond", val: "30M", price: "N/A", demand: "4/10", category: "limited", img: "https://i.postimg.cc/qMyv8Gxq/download-removebg-preview-(34).png" },
            { name: "Dragon Token", val: "N/A", price: "N/A", demand: "4/10", category: "limited", img: "https://i.postimg.cc/pXzLDBJd/download-removebg-preview-(37).png" },
            { name: "Eclipse", val: "N/A", price: "N/A", demand: "10/10", category: "limited", img: "https://i.postimg.cc/3JmxgZFr/download-removebg-preview-(38).png" },
            { name: "Pink Portal", val: "N/A", price: "N/A", demand: "SOON", category: "limited", img: "https://i.postimg.cc/C5VHYB96/image-removebg-preview-(44).png" },
            { name: "Orange Portal", val: "N/A", price: "N/A", demand: "SOON", category: "limited", img: "https://i.postimg.cc/C5VHYB96/image-removebg-preview-(44).png" },
            { name: "Parrot", val: "N/A", price: "499", demand: "1/10", category: "limited", img: "https://i.postimg.cc/J0tYDBpm/download-removebg-preview-(40).png" },

            { name: "Fruit Notifier", val: "3.99B", price: "2.7K", demand: "9/10", category: "gamepass", img: "https://i.postimg.cc/J4ZzbQ55/download-removebg-preview-(20).png" },
            { name: "Dark Blade", val: "840M", price: "1.2K", demand: "9/10", category: "gamepass", img: "https://i.postimg.cc/52JNpFsv/download-removebg-preview-(15).png" },
            { name: "Mythical Scrolls", val: "700M", price: "1.5K", demand: "4/10", category: "gamepass", img: "https://i.postimg.cc/RZmVGngn/download-removebg-preview-(16).png" },
            { name: "Legendary Scrolls", val: "415M", price: "800", demand: "3/10", category: "gamepass", img: "https://i.postimg.cc/PrY5mMQY/download-removebg-preview-(22).png" },
            { name: "+1 Fruit Storage", val: "255M", price: "400", demand: "10/10", category: "gamepass", img: "https://i.postimg.cc/vHfZWvtr/download-removebg-preview-(21).png" },
            { name: "2x Mastery", val: "280M", price: "450", demand: "10/10", category: "gamepass", img: defaultImg },
            { name: "2x Money", val: "280M", price: "450", demand: "10/10", category: "gamepass", img: "https://i.postimg.cc/wjzTFsw-m/download-removebg-preview-(17).png" },
            { name: "2x Boss Drops", val: "170M", price: "350", demand: "6/10", category: "gamepass", img: "https://i.postimg.cc/7Y0ZgNnN/download-removebg-preview-(18).png" },
            { name: "Fast Boats", val: "170M", price: "350", demand: "9/10", category: "gamepass", img: "https://i.postimg.cc/ZKp5rLxF/download-removebg-preview-(19).png" }
        ];

        // --- STATE ---
        let giveItems = [];
        let getItems = [];
        let activeSide = '';

        // --- HELPERS ---
        function parseVal(str) {
            if(str === "N/A") return 0;
            str = String(str).toUpperCase().replace(/,/g, '');
            if(str.includes('B')) return parseFloat(str) * 1_000_000_000;
            if(str.includes('M')) return parseFloat(str) * 1_000_000;
            if(str.includes('K')) return parseFloat(str) * 1_000;
            return parseFloat(str) || 0;
        }
        function formatVal(num) {
            if(num >= 1e9) return (num/1e9).toFixed(2) + 'B';
            if(num >= 1e6) return (num/1e6).toFixed(1) + 'M';
            if(num >= 1e3) return (num/1e3).toFixed(0) + 'K';
            return num;
        }
        function getDemandNum(dem) {
            if(!dem) return 0;
            return parseFloat(dem.split('/')[0]) || 0;
        }
        
        // Helper to parse "15M" or "2.7K" for Actual Price
        function parsePriceNum(str) {
            if(!str || str === "N/A") return 0;
            str = String(str).toUpperCase();
            // Just remove $ and R$ and spaces
            str = str.replace(/[^0-9.BMK]/g, '');
            if(str.includes('B')) return parseFloat(str) * 1_000_000_000;
            if(str.includes('M')) return parseFloat(str) * 1_000_000;
            if(str.includes('K')) return parseFloat(str) * 1_000;
            return parseFloat(str) || 0;
        }

        // --- RENDER ---
        function renderList(side) {
            const listEl = document.getElementById(side + '-list');
            const items = side === 'give' ? giveItems : getItems;
            listEl.innerHTML = '';

            items.forEach((item, index) => {
                let displayVal = item.isPerm ? item.permVal : item.val;
                let displayName = item.name + (item.isPerm ? " (Perm)" : "");
                
                let toggleHtml = '';
                if(item.category === 'fruit') {
                    let activeClass = item.isPerm ? 'perm-active' : '';
                    toggleHtml = `
                    <div class="perm-switch ${activeClass}" onclick="toggleItemMode('${side}', ${index})">
                        <span class="switch-label">Perm?</span>
                        <div class="toggle-bg"><div class="toggle-dot"></div></div>
                    </div>`;
                }

                listEl.innerHTML += `
                <div class="trade-item">
                    <img src="${item.img}" class="item-img">
                    <div class="item-info">
                        <div class="item-name">${displayName}</div>
                        <div class="item-val">${displayVal}</div>
                        <div class="item-dem-tag">Dem: ${item.demand}</div>
                        ${toggleHtml}
                    </div>
                    <div class="remove-btn" onclick="removeItem('${side}', ${index})">&times;</div>
                </div>`;
            });

            updateTotals();
        }

        function updateTotals() {
            // 1. Calculate Trading Value (Bottom)
            let giveTotalVal = giveItems.reduce((acc, i) => acc + parseVal(i.isPerm ? i.permVal : i.val), 0);
            let getTotalVal = getItems.reduce((acc, i) => acc + parseVal(i.isPerm ? i.permVal : i.val), 0);

            document.getElementById('give-total').innerText = formatVal(giveTotalVal);
            document.getElementById('get-total').innerText = formatVal(getTotalVal);

            // 2. Calculate Actual Price (Header)
            let giveRealPrice = giveItems.reduce((acc, i) => acc + parsePriceNum(i.isPerm ? i.permPrice : i.price), 0);
            let getRealPrice = getItems.reduce((acc, i) => acc + parsePriceNum(i.isPerm ? i.permPrice : i.price), 0);
            
            document.getElementById('head-give-price').innerText = formatVal(giveRealPrice);
            document.getElementById('head-get-price').innerText = formatVal(getRealPrice);

            // 3. Demand Calc
            let giveDemAvg = 0, getDemAvg = 0;
            if(giveItems.length > 0) {
                let totalDem = giveItems.reduce((acc, i) => acc + getDemandNum(i.demand), 0);
                giveDemAvg = (totalDem / giveItems.length).toFixed(1);
            }
            if(getItems.length > 0) {
                let totalDem = getItems.reduce((acc, i) => acc + getDemandNum(i.demand), 0);
                getDemAvg = (totalDem / getItems.length).toFixed(1);
            }

            const giveDemEl = document.getElementById('give-demand');
            const getDemEl = document.getElementById('get-demand');
            giveDemEl.innerText = giveDemAvg + "/10";
            getDemEl.innerText = getDemAvg + "/10";
            giveDemEl.className = "dem-val " + (giveDemAvg >= 8 ? 'dem-high' : (giveDemAvg >= 5 ? 'dem-mid' : 'dem-low'));
            getDemEl.className = "dem-val " + (getDemAvg >= 8 ? 'dem-high' : (getDemAvg >= 5 ? 'dem-mid' : 'dem-low'));

            // 4. Result Calc (Based on Trading Value)
            const statusEl = document.getElementById('status');
            const diffEl = document.getElementById('diff');

            if(giveTotalVal === 0 && getTotalVal === 0) {
                statusEl.innerHTML = "---";
                statusEl.className = "status-text";
                diffEl.innerText = "Add items to calculate";
                return;
            }

            let pct = giveTotalVal === 0 ? 100 : (getTotalVal / giveTotalVal) * 100;
            let diff = getTotalVal - giveTotalVal;
            let diffStr = (diff >= 0 ? "+" : "") + formatVal(diff);

            if(pct >= 110) { statusEl.innerText = "BIG WIN ðŸš€"; statusEl.className = "status-text status-win"; }
            else if(pct >= 102) { statusEl.innerText = "WIN âœ…"; statusEl.className = "status-text status-win"; }
            else if(pct >= 90) { statusEl.innerText = "FAIR âš–ï¸"; statusEl.className = "status-text status-fair"; }
            else { statusEl.innerText = "LOSS âŒ"; statusEl.className = "status-text status-loss"; }

            diffEl.innerText = `${diffStr} Value Difference`;
        }

        // --- ACTIONS ---
        function toggleItemMode(side, index) {
            let list = side === 'give' ? giveItems : getItems;
            if(list[index].permVal) {
                list[index].isPerm = !list[index].isPerm;
                renderList(side);
            }
        }

        function removeItem(side, index) {
            if(side === 'give') giveItems.splice(index, 1);
            else getItems.splice(index, 1);
            renderList(side);
        }

        // --- MODAL ---
        function openModal(side) {
            activeSide = side;
            document.getElementById('modal').style.display = 'flex';
            renderModalItems();
        }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        function renderModalItems() {
            const list = document.getElementById('modal-items');
            const search = document.getElementById('modal-search').value.toLowerCase();
            list.innerHTML = '';

            data.filter(x => x.name.toLowerCase().includes(search)).forEach(item => {
                let catClass = 'tag-fruit';
                if(item.category === 'limited') catClass = 'tag-limited';
                if(item.category === 'gamepass') catClass = 'tag-gamepass';

                const div = document.createElement('div');
                div.className = 'select-item';
                div.innerHTML = `
                    <img src="${item.img}"> 
                    <div><b>${item.name}</b> <br> <span style="color:#e1b12c">${item.val}</span></div>
                    <span class="cat-tag ${catClass}">${item.category}</span>
                `;
                div.onclick = () => {
                    let newItem = { ...item, isPerm: false }; 
                    if(activeSide === 'give') giveItems.push(newItem);
                    else getItems.push(newItem);
                    renderList(activeSide);
                    closeModal();
                };
                list.appendChild(div);
            });
        }
        document.getElementById('modal-search').addEventListener('input', renderModalItems);

    </script>
</body>
</html>
